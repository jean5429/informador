<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Painel</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Biblioteca de Ícones Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Fonte Inter (Moderna e Legível) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilo base para a fonte e o loader */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        
        /* Estilo do Loader */
        .loader {
            border: 4px solid #374151; /* border-gray-700 */
            border-top: 4px solid #3b82f6; /* border-blue-500 */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 3rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Melhorando o foco do contenteditable */
        [contenteditable]:focus {
            outline: 2px solid #3b82f6;
            border-radius: 4px;
            background-color: #374151;
        }
    </style>
</head>
<!-- ATUALIZADO: Layout de tela cheia (h-screen, flex-col, overflow-hidden) e padding global -->
<body class="text-gray-100 h-screen w-full p-6 md:p-10 flex flex-col overflow-hidden">

    <!-- ATUALIZADO: Container principal que preenche a tela (removido max-w-7xl) -->
    <div class="flex-1 flex flex-col min-h-0 w-full">
        <!-- CABEÇALHO: Saudação, Foco e Relógio -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <!-- Saudação e Foco do Dia -->
            <div>
                <h1 class="text-3xl font-bold" id="greeting"></h1>
                <p class="text-lg text-gray-400">Seu foco para hoje é:</p>
                <div id="focus-task" 
                     contenteditable="true" 
                     class="text-lg font-medium text-blue-300 p-1 -ml-1 transition-all"
                     title="Clique para editar seu foco do dia">
                    [Carregando...]
                </div>
            </div>
            
            <!-- Relógio e Data -->
            <div class="text-left md:text-right">
                <div id="clock" class="text-5xl font-bold text-blue-400">--:--</div>
                <div id="date" class="text-xl text-gray-300">-- de ------ de ----</div>
            </div>
        </header>

        <!-- CONTEÚDO PRINCIPAL: Grid de Cards -->
        <!-- ATUALIZADO: 'flex-1' faz o grid preencher o espaço vertical -->
        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 flex-1">

            <!-- Card: Clima (Americana/SP) -->
            <!-- ATUALIZADO: h-full faz este card esticar verticalmente -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg flex flex-col justify-between h-full md:col-span-1 lg:row-span-1">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Clima Atual</h2>
                    <i data-lucide="map-pin" class="text-gray-400"></i>
                </div>
                <div id="weather-content" class="text-center flex-1 flex flex-col items-center justify-center">
                    <!-- Conteúdo do Clima será injetado aqui -->
                    <div class="loader"></div>
                </div>
                <div id="weather-location" class="text-center text-gray-400 text-lg mt-4">
                    Americana, SP
                </div>
            </div>

            <!-- Card: Notícias Pokémon.com (ATUALIZADO) -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg md:col-span-1 lg:col-span-1 flex flex-col">
                <div class="flex items-center gap-3 mb-4">
                    <!-- Ícone e cor ATUALIZADOS -->
                    <i data-lucide="newspaper" class="text-yellow-400 w-6 h-6"></i>
                    <!-- Título ATUALIZADO -->
                    <h2 class="text-2xl font-semibold">Pokémon.com News</h2>
                </div>
                <!-- ID do feed ATUALIZADO -->
                <ul id="pokemon-feed" class="space-y-3 overflow-y-auto" style="max-height: 250px;">
                    <!-- Feed será injetado aqui -->
                    <div class="loader"></div>
                </ul>
            </div>

            <!-- Card: Eventos Pokémon -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="calendar-clock" class="text-green-400 w-6 h-6"></i>
                    <h2 class="text-2xl font-semibold">Eventos Pokémon</h2>
                </div>
                <div class="space-y-4">
                    <!-- Scarlet/Violet -->
                    <div>
                        <h3 class="text-lg font-medium text-purple-300">Scarlet & Violet</h3>
                        <!-- Informação estática como placeholder -->
                        <p class="text-gray-200">Tera Raid: 'Mightiest' Feraligatr</p>
                        <p class="text-sm text-gray-400">Tempo: Restam 1 dia e 8 horas.</p>
                    </div>
                    <!-- Legends ZA (ATUALIZADO) -->
                    <div>
                        <h3 class="text-lg font-medium text-blue-300">Legends Z-A</h3>
                        <p class="text-gray-200">Ranked Battles Season 1</p>
                        <!-- Texto do evento ATUALIZADO -->
                        <p class="text-sm text-gray-400">Termina: 04/Nov/2025, 9:59 p.m. PST</p>
                    </div>
                </div>
            </div>
            
            <!-- Card: Notícias G1 -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg md:col-span-1 lg:col-span-1 flex flex-col">
                <div class="flex items-center gap-3 mb-4">
                    <img src="https://s.glbimg.com/ss/Glb/g1/static/g1-logo-min.png" alt="Logo G1" class="h-6 bg-white rounded-full p-1">
                    <h2 class="text-2xl font-semibold">Últimas do G1</h2>
                </div>
                <!-- Altura máxima reduzida para 250px -->
                <ul id="g1-feed" class="space-y-3 overflow-y-auto" style="max-height: 250px;">
                    <!-- Feed do G1 será injetado aqui -->
                    <div class="loader"></div>
                </ul>
            </div>

        </main>

        <!-- ATUALIZADO: Rodapé limpo -->
        <footer class="text-center text-gray-600 text-sm mt-10 h-6">
        </footer>
    </div>

    <!-- CÓDIGO SCRIPT COMPLETO E CORRIGIDO -->
    <script>
        // --- CONSTANTES E URLs ---
        const G1_RSS_URL = "https://api.rss2json.com/v1/api.json?rss_url=https://g1.globo.com/rss/g1/";
        // ATUALIZADO: Proxy para o feed RSS oficial do Pokémon.com
        const POKEMON_COM_PROXY_URL = "https://api.allorigins.win/get?url=https%3A%2F%2Fwww.pokemon.com%2Fus%2Fpokemon-news%2Frss";
        const WEATHER_URL = "https://wttr.in/Americana?format=j1"; // API de clima simples
        const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 Minutos
        // ATUALIZADO: Intervalo do relógio para 1 minuto
        const CLOCK_INTERVAL = 60 * 1000; // 1 Minuto

        // --- ELEMENTOS DO DOM ---
        const clockEl = document.getElementById('clock');
        const dateEl = document.getElementById('date');
        const greetingEl = document.getElementById('greeting');
        const focusTaskEl = document.getElementById('focus-task');
        const weatherContentEl = document.getElementById('weather-content');
        const weatherLocationEl = document.getElementById('weather-location');
        const g1FeedEl = document.getElementById('g1-feed');
        // ATUALIZADO: Variável do DOM
        const pokemonFeedEl = document.getElementById('pokemon-feed');

        // --- FUNÇÕES DE ATUALIZAÇÃO ---

        /**
         * Atualiza o relógio e a data.
         */
        function updateClockAndDate() {
            const now = new Date();
            
            // Relógio (HH:MM)
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            clockEl.textContent = now.toLocaleTimeString('pt-BR', timeOptions);
            
            // Data (ex: sexta-feira, 24 de outubro)
            const dateOptions = { weekday: 'long', day: 'numeric', month: 'long' };
            let dateString = now.toLocaleDateString('pt-BR', dateOptions);
            dateEl.textContent = dateString.charAt(0).toUpperCase() + dateString.slice(1);
        }

        /**
         * Define a saudação (Bom dia, Boa tarde, Boa noite)
         */
        function updateGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) {
                greetingEl.textContent = "Bom dia!";
            } else if (hour < 18) {
                greetingEl.textContent = "Boa tarde!";
            } else {
                greetingEl.textContent = "Boa noite!";
            }
        }
        
        /**
         * Carrega e salva a tarefa de foco do localStorage
         */
        function setupFocusTask() {
            const savedFocus = localStorage.getItem('dailyFocusTask');
            focusTaskEl.textContent = savedFocus || '[Clique para definir seu foco]';
            
            // Salva ao perder o foco (blur)
            focusTaskEl.addEventListener('blur', () => {
                localStorage.setItem('dailyFocusTask', focusTaskEl.textContent.trim());
            });
            
            // Impede nova linha ao pressionar Enter
            focusTaskEl.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    focusTaskEl.blur();
                }
            });
        }

        /**
         * Mapeia a descrição do tempo para um ícone Lucide
         */
        function getWeatherIcon(description) {
            const desc = description.toLowerCase();
            if (desc.includes('sunny') || desc.includes('clear')) return 'sun';
            if (desc.includes('partly cloudy')) return 'cloud-sun';
            if (desc.includes('cloudy') || desc.includes('overcast')) return 'cloud';
            if (desc.includes('rain') || desc.includes('shower')) return 'cloud-rain';
            if (desc.includes('thunder')) return 'cloud-lightning';
            if (desc.includes('snow')) return 'cloud-snow';
            if (desc.includes('fog') || desc.includes('mist')) return 'cloud-fog';
            return 'sun'; // Padrão
        }

        /**
         * Busca e exibe o clima de Americana/SP
         */
        async function fetchWeather() {
            try {
                const response = await fetch(WEATHER_URL);
                if (!response.ok) throw new Error('Erro na rede ao buscar clima');
                
                const data = await response.json();
                const current = data.current_condition[0];
                const weatherDesc = current.weatherDesc[0].value;
                const iconName = getWeatherIcon(weatherDesc);

                weatherContentEl.innerHTML = `
                    <div id="weather-icon" class="mb-2">
                        <i data-lucide="${iconName}" class="w-24 h-24 text-blue-400"></i>
                    </div>
                    <div classs="text-7xl font-bold">${current.temp_C}°C</div>
                    <div class="text-2xl text-gray-300">${weatherDesc}</div>
                `;
                weatherLocationEl.textContent = `${data.nearest_area[0].areaName[0].value}, ${data.nearest_area[0].region[0].value}`;
                
                // Recria o ícone do clima
                lucide.createIcons();

            } catch (error) {
                console.error("Erro ao buscar clima:", error);
                weatherContentEl.innerHTML = '<p class="text-red-400">Não foi possível carregar o clima.</p>';
            }
        }

        /**
         * Busca notícias (formato rss2json) e as exibe (usado para G1)
         */
        async function fetchNews(url, container, limit) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Erro na rede ao buscar notícias');

                const data = await response.json();
                if (data.status !== 'ok') throw new Error('Erro na API RSS');

                const items = data.items.slice(0, limit);
                
                // Limpa o loader
                container.innerHTML = '';
                
                // Adiciona os itens da lista
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = "border-b border-gray-700 pb-2 last:border-b-0";
                    li.innerHTML = `
                        <a href="${item.link}" target="_blank" rel="noopener noreferrer" 
                           class="text-gray-200 hover:text-blue-400 transition-colors duration-200">
                            ${item.title}
                        </a>
                    `;
                    container.appendChild(li);
                });

            } catch (error) {
                console.error(`Erro ao buscar notícias de ${url}:`, error);
                container.innerHTML = '<li class="text-red-400">Não foi possível carregar as notícias.</li>';
            }
        }

        /**
         * ATUALIZADO: Busca notícias do Pokémon.com usando proxy (allorigins) e DOMParser
         */
        async function fetchPokemonNews(url, container, limit) {
            try {
                const response = await fetch(url); // Este é o proxy allorigins
                if (!response.ok) throw new Error('Erro na rede (proxy)');
                
                const data = await response.json(); // allorigins retorna JSON
                const xmlString = data.contents;
                
                // Parseia a string XML
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, "application/xml");
                
                // Checa por erros de parsing
                const parserError = xmlDoc.querySelector("parsererror");
                if (parserError) {
                    console.error("Erro ao parsear XML:", parserError);
                    throw new Error('Erro ao ler o feed XML');
                }

                // Pega os itens do feed (padrão RSS)
                const items = Array.from(xmlDoc.querySelectorAll("item")).slice(0, limit);
                
                container.innerHTML = ''; // Limpa o loader
                
                items.forEach(item => {
                    const title = item.querySelector("title")?.textContent || 'Sem Título';
                    const link = item.querySelector("link")?.textContent || '#';
                    
                    const li = document.createElement('li');
                    li.className = "border-b border-gray-700 pb-2 last:border-b-0";
                    li.innerHTML = `
                        <a href="${link}" target="_blank" rel="noopener noreferrer" 
                           class="text-gray-200 hover:text-blue-400 transition-colors duration-200">
                            ${title}
                        </a>
                    `;
                    container.appendChild(li);
                });

            } catch (error) {
                console.error(`Erro ao buscar notícias de ${url}:`, error);
                // Mensagem de erro ATUALIZADA
                container.innerHTML = '<li class="text-red-400">Não foi possível carregar as notícias. (Pokémon.com)</li>';
            }
        }
        
        /**
         * Função principal para buscar todos os dados
         */
        function fetchAllData() {
            fetchWeather();
            fetchNews(G1_RSS_URL, g1FeedEl, 5);
            // ATUALIZADO: Chama a nova função específica do Pokémon.com
            fetchPokemonNews(POKEMON_COM_PROXY_URL, pokemonFeedEl, 5);
        }

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            // Atualiza relógio e saudação imediatamente
            updateClockAndDate();
            updateGreeting();
            setupFocusTask();
            
            // Busca todos os dados da API
            fetchAllData();

            // Cria os ícones estáticos (map-pin, newspaper, calendar-clock)
            lucide.createIcons();
            
            // Define os intervalos de atualização
            // ATUALIZADO: Relógio a cada 1 minuto
            setInterval(updateClockAndDate, CLOCK_INTERVAL); 
            setInterval(fetchAllData, REFRESH_INTERVAL); // Dados a cada 5 minutos
        });

    </script>
</body>
</html>

